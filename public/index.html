<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webchat</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <h1>Webchat</h1>
    <div>
      <input type="text" id="input-nickname" data-testid="nickname-box" />
      <button type="button" id="submit-nickname" data-testid="nickname-save">
        Alterar Nickname
      </button>
    </div>
    <div>
      <form action="">
        <input type="text" id="input-message" data-testid="message-box" />
        <button type="submit" id="submit-message" data-testid="send-button">
          Enviar Mensagem
        </button>
      </form>
    </div>
    <ul id="list"></ul>
    <script>
      const socket = io();

      const nicknameInput = document.getElementById('input-nickname');
      const btnSaveNickname = document.getElementById('submit-nickname');

      const messageInput = document.getElementById('input-message');
      const btnSendMessage = document.getElementById('submit-message');

      const messagesList = document.getElementById('list');

      // btnSaveNickname.addEventListener('click', (e) => {});

      btnSendMessage.addEventListener('click', (e) => {
        e.preventDefault();
        // Emitir o evento 'message'
        socket.emit('message', {
          message: messageInput.value,
          nickname: nicknameInput.value,
          date: new Date(),
        });
        //
        messageInput.value = '';
      });

      socket.on('defaultNickname', (data) => {
        nicknameInput.value = data;
      });

      socket.on('loadMessages', (data) => {
        console.log(data);
        if (data.length) {
          data.map((item) => {
            const li = document.createElement('li');
            li.textContent = `${new Date(item.date).toLocaleString(
              'pt-BR'
            )} - ${item.nickname}: ${item.message}`;
            li.setAttribute('data-testid', 'message');
            list.appendChild(li);
          });
        }
      });

      socket.on('serverResponse', (data) => {
        console.log(data);
        const li = document.createElement('li');
        li.textContent = `${new Date(data.date).toLocaleString('pt-BR')} ${
          data.nickname
        }: ${data.message}`;
        li.setAttribute('data-testid', 'message');
        list.appendChild(li);
      });
    </script>
  </body>
</html>
