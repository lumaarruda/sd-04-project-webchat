<html>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="http://chancejs.com/chance.min.js"></script>
  <body>
    <input data-testid="nickname-box" type="text" id="nickInput" />
    <button data-testid="nickname-save">Nick</button>

    <ul id="listaMensagem"></ul>

    <input data-testid="message-box" id="textInput" autocomplete="off" />
    <button data-testid="send-button" onclick="sendMsg()">Send</button>

    <script>
      const socket = io('http://localhost:3000/');

      const sendMsg = () => {
        const socket = io();

        const chatMessage = document.getElementById('textInput').value;
        const nickname = document.getElementById('nickInput').value;

        socket.emit('message', { nickname, chatMessage });
      };

      window.onload = () => {
        socket.on('history', (data) => {
          console.log(data)
          document.getElementById('listaMensagem').innerHTML = data.map(
            (mes) => `<li data-testid="message">${mes.date} - ${mes.nickname}: ${mes.message}</li>`
          ).join('');
        });


        socket.on('message', (data) => {
          console.log(data);
          const li = document.createElement('li');
          li.setAttribute('data-testid', 'message');
          li.textContent = data;
          document.getElementById('listaMensagem').appendChild(li);
        });
      };
    </script>
  </body>
</html>
