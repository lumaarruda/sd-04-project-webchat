<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <div>
      <form class="chat">
        <input type="text" id="nickname" placeholder="Digite seu nome" />
        <div>
          <div class="messages"></div>
        </div>
        <input
          type="text"
          id="chatMessage"
          placeholder="Digite sua mensagem"
        /><button type="submit">Enviar</button>
      </form>
      <script type="text/javascript">
        const socket = io('http://localhost:3000');

        function renderMessage(message) {
          $('.messages').append('<div class="message">' + message + '</div>');
        }

        socket.on('previousMessage', function (allMessages) {
          for (const iterator of allMessages) {
            renderMessage(
              `${iterator.dateTime} - ${iterator.nickname}: ${iterator.chatMessage}!`
            );
          }
        });

        socket.on('message', function (message) {
          renderMessage(message);
        });

        $('#chat').submit(function (event) {
          event.preventDefault();

          let nickname = $('input[id=nickname]').val();
          let chatMessage = $('input[id=chatMessage]').val();

          if (nickname.length && chatMessage.length) {
            //const messageObject = { nickname, chatMessage };
            // renderMessage(messageObject);
            socket.emit('message', { nickname, chatMessage });
          }
        });
      </script>
    </div>
  </body>
</html>
